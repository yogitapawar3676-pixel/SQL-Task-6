CREATE DATABASE subquery_task;
USE subquery_task;

CREATE TABLE Departments (
    department_id INT PRIMARY KEY,
    department_name VARCHAR(50)
);

CREATE TABLE Employees (
    emp_id INT PRIMARY KEY,
    emp_name VARCHAR(50),
    department_id INT,
    salary DECIMAL(10, 2),
    FOREIGN KEY (department_id) REFERENCES Departments(department_id)
);

INSERT INTO Departments VALUES
(1, 'HR'),
(2, 'IT'),
(3, 'Finance');

INSERT INTO Employees VALUES
(101, 'Alice', 1, 50000),
(102, 'Bob', 2, 65000),
(103, 'Charlie', 2, 70000),
(104, 'David', 3, 60000),
(105, 'Eva', 1, 55000);

SELECT emp_name,
       salary,
       (SELECT AVG(salary) FROM Employees) AS avg_salary
FROM Employees;

SELECT emp_name, salary
FROM Employees
WHERE department_id IN (
    SELECT department_id
    FROM Departments
    WHERE department_name = 'IT'
);

SELECT emp_name, salary
FROM Employees e
WHERE salary > (
    SELECT AVG(salary)
    FROM Employees
    WHERE department_id = e.department_id
);

SELECT department_name
FROM Departments d
WHERE EXISTS (
    SELECT 1
    FROM Employees e
    WHERE e.department_id = d.department_id
    AND salary > 60000
);

SELECT dept_name, max_salary
FROM (
    SELECT d.department_name AS dept_name,
           MAX(e.salary) AS max_salary
    FROM Departments d
    JOIN Employees e ON d.department_id = e.department_id
    GROUP BY d.department_name
) AS dept_max;
